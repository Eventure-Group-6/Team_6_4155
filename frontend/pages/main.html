

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Eventure â€” Discover Clubs</title>

  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../assets/css/styles.css">
</head>
<body style="padding:20px;">

  <div class="main-wrap" role="main" aria-label="Main feed and navigation">
    <aside class="sidebar" aria-label="Sidebar navigation">
      <div class="brand">
        <span class="logo">Eventure</span>
        <div>
          <div style="font-weight:700">Eventure</div>
          <div class="small" style="margin-top:4px">Clubs & Events</div>
        </div>
      </div>

      <nav class="nav" aria-label="Main navigation">
        <a href="main.html" aria-current="page">Discover</a>
        <a href="#" onclick="showMyClubs()">My Clubs</a>
        <a href="#" onclick="showPostForm()">Post</a>
        <a href="#" onclick="showEvents()">Events</a>
        <a href="#" onclick="showDiscussion()">Discussion</a>
        <a href="login.html">Sign out</a>
      </nav>

      <div style="margin-top:16px;font-size:0.95rem;color:var(--muted)">
        <div style="margin-bottom:8px;font-weight:600">Favorites</div>
        <a href="#" onclick="showFavorites()" style="color:var(--accent-2);text-decoration:none;font-size:0.9rem;">View Saved Flyers</a>
      </div>
    </aside>

    <section class="feed" aria-label="Club poster feed">
      <!-- Poster 1: Static image style -->
      <article class="poster" role="article" aria-labelledby="p1title">
        <div class="meta">
          <div>
            <h3 id="p1title">Data Science Society</h3>
            <div class="small">Technology â€¢ Meets Tuesdays</div>
          </div>
          <div class="small">4.9 â˜…</div>
        </div>

        <img src="../assets/image.png" alt="Data Science Society poster">

        <div>
          <p>Explore data analytics, machine learning, and AI. All skill levels welcome.</p>
          <div class="actions">
            <div>
              <button class="icon-btn" aria-pressed="false">â¤ Save</button>
              <button class="icon-btn" onclick="addToEvents('Data Science Society', 'Tuesdays 5:30 PM')">ğŸ“… Add Event</button>
              <button class="icon-btn" onclick="shareFlyer('Data Science Society')">ğŸ”— Share</button>
            </div>
            <button class="btn" onclick="openDetails('Data Science Society')">View</button>
          </div>
        </div>
      </article>

      <!-- Poster 2: Animated/dynamic (CSS-based) -->
      <article class="poster" role="article" aria-labelledby="p2title" style="background:linear-gradient(180deg,#fff4f2,#fff7f0);">
        <div class="meta">
          <div>
            <h3 id="p2title">Fencing Club</h3>
            <div class="small">Sports â€¢ Mondays & Thursdays</div>
          </div>
          <div class="small">4.7 â˜…</div>
        </div>

        <img src="../assets/image copy.png" alt="Fencing Club poster">

        <div>
          <p>Learn the art of fencing. Equipment provided for beginners. Join our competitive team.</p>
          <div class="actions">
            <div>
              <button class="icon-btn">â¤ Save</button>
              <button class="icon-btn" onclick="addToEvents('Fencing Club', 'Mondays & Thursdays 6:00 PM')">ğŸ“… Add Event</button>
              <button class="icon-btn" onclick="shareFlyer('Fencing Club')">ğŸ”— Share</button>
            </div>
            <button class="btn" onclick="openDetails('Fencing Club')">View</button>
          </div>
        </div>
      </article>

      <!-- Poster 3: Another style -->
      <article class="poster" role="article" aria-labelledby="p3title" style="background:linear-gradient(180deg,#fffef2,#f5fff1);">
        <div class="meta">
          <div>
            <h3 id="p3title">Association of Computing Machinery</h3>
            <div class="small">Technology â€¢ Wednesdays</div>
          </div>
          <div class="small">5.0 â˜…</div>
        </div>

        <img src="../assets/image copy 2.png" alt="ACM poster">

        <div>
          <p>Join ACM for coding workshops, hackathons, and tech talks. Network with industry professionals.</p>
          <div class="actions">
            <div>
              <button class="icon-btn">â¤ Save</button>
              <button class="icon-btn" onclick="addToEvents('Association of Computing Machinery', 'Wednesdays 7:00 PM')">ğŸ“… Add Event</button>
              <button class="icon-btn" onclick="shareFlyer('Association of Computing Machinery')">ğŸ”— Share</button>
            </div>
            <button class="btn" onclick="openDetails('Association of Computing Machinery')">View</button>
          </div>
        </div>
      </article>

      <div class="footer-note">Tip: Scroll up/down to browse â€” posters snap into view for easy preview.</div>
      <div style="text-align:center;margin-top:15px;">
        <button class="btn" onclick="window.location.href='main.html'" style="background:rgba(255,255,255,0.8);color:#374151;border:1px solid rgba(0,0,0,0.15);">â† Back to Main</button>
      </div>
    </section>
  </div>

<script>
  // Check authentication on page load
  async function checkAuth() {
    try {
      const response = await fetch('http://localhost:8080/api/session', {
        credentials: 'include'
      });
      const data = await response.json();
      if(!data.authenticated) {
        window.location.href = 'login.html';
      }
    } catch(error) {
      console.error('Backend offline, running in demo mode');
      // Allow access in demo mode
      const demoUser = localStorage.getItem('demoUser');
      if(!demoUser) {
        alert('Demo mode: Please create an account first');
        window.location.href = 'login.html';
      }
    }
  }
  
  // Load flyers from API with animation
  async function loadFlyers() {
    const feed = document.querySelector('.feed');
    feed.classList.add('fade-out');
    
    setTimeout(() => {
      // Restore original content
      feed.innerHTML = `
        <article class="poster" role="article" aria-labelledby="p1title">
          <div class="meta">
            <div>
              <h3 id="p1title">Data Science Society</h3>
              <div class="small">Technology â€¢ Meets Tuesdays</div>
            </div>
            <div class="small">4.9 â˜…</div>
          </div>
          <img src="../assets/image.png" alt="Data Science Society poster">
          <div>
            <p>Explore data analytics, machine learning, and AI. All skill levels welcome.</p>
            <div class="actions">
              <div>
                <button class="icon-btn" aria-pressed="false" onclick="toggleSave(1, this)">â¤ Save</button>
                <button class="icon-btn" onclick="addToEvents('Data Science Society', 'Tuesdays 5:30 PM')">ğŸ“… Add Event</button>
                <button class="icon-btn" onclick="shareFlyer('Data Science Society')">ğŸ”— Share</button>
              </div>
              <button class="btn" onclick="openDetails('Data Science Society', this)">View</button>
            </div>
          </div>
        </article>
        
        <article class="poster" role="article" style="background:linear-gradient(180deg,#fff4f2,#fff7f0);">
          <div class="meta">
            <div>
              <h3>Fencing Club</h3>
              <div class="small">Sports â€¢ Mondays & Thursdays</div>
            </div>
            <div class="small">4.7 â˜…</div>
          </div>
          <img src="../assets/image copy.png" alt="Fencing Club poster">
          <div>
            <p>Learn the art of fencing. Equipment provided for beginners. Join our competitive team.</p>
            <div class="actions">
              <div>
                <button class="icon-btn" onclick="toggleSave(2, this)">â¤ Save</button>
                <button class="icon-btn" onclick="addToEvents('Fencing Club', 'Mondays & Thursdays 6:00 PM')">ğŸ“… Add Event</button>
                <button class="icon-btn" onclick="shareFlyer('Fencing Club')">ğŸ”— Share</button>
              </div>
              <button class="btn" onclick="openDetails('Fencing Club', this)">View</button>
            </div>
          </div>
        </article>
        
        <article class="poster" role="article" style="background:linear-gradient(180deg,#fffef2,#f5fff1);">
          <div class="meta">
            <div>
              <h3>Association of Computing Machinery</h3>
              <div class="small">Technology â€¢ Wednesdays</div>
            </div>
            <div class="small">5.0 â˜…</div>
          </div>
          <img src="../assets/image copy 2.png" alt="ACM poster">
          <div>
            <p>Join ACM for coding workshops, hackathons, and tech talks. Network with industry professionals.</p>
            <div class="actions">
              <div>
                <button class="icon-btn" onclick="toggleSave(3, this)">â¤ Save</button>
                <button class="icon-btn" onclick="addToEvents('Association of Computing Machinery', 'Wednesdays 7:00 PM')">ğŸ“… Add Event</button>
                <button class="icon-btn" onclick="shareFlyer('Association of Computing Machinery')">ğŸ”— Share</button>
              </div>
              <button class="btn" onclick="openDetails('Association of Computing Machinery', this)">View</button>
            </div>
          </div>
        </article>
        
      `;
      
      // Add user-created posts
      createdPosts.forEach(post => {
        const imageHTML = post.image ? `<img src="${post.image}" alt="${post.title}">` : `<div class="poster-img" style="background:linear-gradient(135deg,#bfdbfe,#ddd6fe);">ğŸ‰ ${post.title}</div>`;
        const eventButton = post.eventTime ? `<button class="icon-btn" onclick="addToEvents('${post.title}', '${post.eventTime}')">ğŸ“… Add Event</button>` : '';
        const postHTML = `
          <article class="poster" style="background:linear-gradient(180deg,#e0f2fe,#f0f9ff);border:2px solid rgba(255,255,255,0.8);">
            <div class="meta">
              <div>
                <h3 style="color:#1e293b;font-weight:700;">${post.title}</h3>
                <div class="small" style="color:#475569;">${post.org} â€¢ ${post.date}</div>
              </div>
              <div class="small" style="color:#059669;">âœ¨ New</div>
            </div>
            ${imageHTML}
            <div>
              <p style="color:#475569;margin:15px 0;">${post.description}</p>
              <div class="actions">
                <div>
                  <button class="icon-btn" onclick="toggleSave(${post.id}, this)">â¤ Save</button>
                  ${eventButton}
                  <button class="icon-btn" onclick="shareFlyer('${post.title}')">ğŸ”— Share</button>
                </div>
                <button class="btn" onclick="openDetails('${post.title}', this)">View</button>
              </div>
            </div>
          </article>
        `;
        feed.innerHTML = postHTML + feed.innerHTML;
      });
      
      feed.innerHTML += `<div class="footer-note">Tip: Scroll up/down to browse â€” posters snap into view for easy preview.</div>`;
      
      feed.classList.remove('fade-out');
      feed.classList.add('fade-in');
      
      // Re-attach event listeners
      document.querySelectorAll('.icon-btn').forEach(btn=>{
        btn.addEventListener('click', ()=> {
          const pressed = btn.getAttribute('aria-pressed') === 'true';
          btn.setAttribute('aria-pressed', String(!pressed));
          if(btn.textContent.includes('â¤')) {
            btn.textContent = pressed ? 'â¤ Save' : 'âœ” Saved';
          }
        });
      });
    }, 150);
  }
  
  function openDetails(name, element) {
    // Get card position for animation origin
    const card = element ? element.closest('.poster') : null;
    
    // Create overlay
    const overlay = document.createElement('div');
    overlay.className = 'card-overlay';
    overlay.onclick = closeDetails;
    
    // Create expanded card
    const expandedCard = document.createElement('div');
    expandedCard.className = 'expanded-card';
    expandedCard.innerHTML = `
      <button class="close-btn" id="closeBtn">Ã—</button>
      <div style="text-align:right;margin-bottom:10px;">
        <button onclick="closeDetails()" style="background:none;border:none;color:#64748b;cursor:pointer;font-size:14px;">Close Ã—</button>
      </div>
      <div style="margin-bottom: 25px;">
        <h2 style="color:#0f172a;font-weight:800;font-size:1.8rem;margin-bottom:8px;">${name}</h2>
        <div style="color:#64748b;font-weight:600;font-size:1rem;">Event Details</div>
      </div>
      
      <div style="background:linear-gradient(135deg,#c7f9e1,#bfdbfe);border-radius:16px;padding:45px;text-align:center;margin:25px 0;border:2px solid rgba(255,255,255,0.8);">
        <div style="font-size:3.5rem;margin-bottom:15px;">ğŸ‰</div>
        <h3 style="color:#0f172a;font-weight:700;font-size:1.4rem;">${name}</h3>
      </div>
      
      <div style="margin:25px 0;">
        <h4 style="color:#0f172a;font-weight:700;font-size:1.2rem;margin-bottom:15px;">About This Event</h4>
        <p style="color:#374151;line-height:1.7;font-size:1rem;font-weight:500;">
          ${name === 'Data Science Society' ? 'Dive into the world of data science with hands-on workshops covering Python, R, machine learning algorithms, and data visualization. Work on real-world projects, participate in Kaggle competitions, and connect with industry professionals. Whether you\'re a beginner or advanced, we have something for everyone!' : 
            name === 'Fencing Club' ? 'Experience the elegance and intensity of fencing! Our club welcomes all skill levels from complete beginners to competitive fencers. Learn foil, Ã©pÃ©e, and sabre techniques from certified coaches. Equipment is provided for newcomers. Join our team for local and regional tournaments, or just fence for fun and fitness!' :
            name === 'Association of Computing Machinery' ? 'ACM is the premier computing organization on campus. Attend weekly tech talks from industry leaders, participate in hackathons, work on open-source projects, and prepare for technical interviews. Network with recruiters from top tech companies and collaborate on innovative software projects with fellow members.' :
            'An exciting event you won\'t want to miss! Join us for a great time with fellow students.'}
        </p>
      </div>
      
      <div style="margin:25px 0;background:rgba(248,250,252,0.8);padding:20px;border-radius:12px;border:1px solid rgba(226,232,240,0.8);">
        <h4 style="color:#0f172a;font-weight:700;font-size:1.2rem;margin-bottom:15px;">Event Details</h4>
        <div style="color:#374151;font-weight:500;">
          <p style="margin:8px 0;font-size:1rem;"><strong style="color:#1e293b;">When:</strong> ${name === 'Data Science Society' ? 'Tuesdays 5:30 PM' : name === 'Fencing Club' ? 'Mondays & Thursdays 6:00 PM' : name === 'Association of Computing Machinery' ? 'Wednesdays 7:00 PM' : 'TBD'}</p>
          <p style="margin:8px 0;font-size:1rem;"><strong style="color:#1e293b;">Where:</strong> ${name === 'Data Science Society' ? 'Woodward Hall 335' : name === 'Fencing Club' ? 'Recreation Center Gym 2' : name === 'Association of Computing Machinery' ? 'Student Union 340' : 'Student Union Building'}</p>
          <p style="margin:8px 0;font-size:1rem;"><strong style="color:#1e293b;">Cost:</strong> Free for students</p>
        </div>
      </div>
      
      <div style="display:flex;gap:12px;margin-top:35px;">
        ${(name === 'Data Science Society' || name === 'Fencing Club' || name === 'Association of Computing Machinery') ? `<button class="btn" style="flex:1;font-weight:600;" onclick="addToEvents('${name}', '${name === 'Data Science Society' ? 'Tuesdays 5:30 PM' : name === 'Fencing Club' ? 'Mondays & Thursdays 6:00 PM' : 'Wednesdays 7:00 PM'}'); closeDetails();">Add Event</button>` : ''}
        <button class="icon-btn" style="font-weight:600;">â¤ Save</button>
        <button class="icon-btn" style="font-weight:600;" onclick="shareFlyer('${name}')">ğŸ”— Share</button>
      </div>
    `;
    
    // Add to DOM
    document.body.appendChild(overlay);
    document.body.appendChild(expandedCard);
    
    // Add close button event listener
    const closeBtn = expandedCard.querySelector('#closeBtn');
    closeBtn.addEventListener('click', closeDetails);
    
    // Trigger animation
    setTimeout(() => {
      overlay.classList.add('show');
      expandedCard.classList.add('show');
    }, 10);
  }
  
  function closeDetails() {
    const overlay = document.querySelector('.card-overlay');
    const expandedCard = document.querySelector('.expanded-card');
    
    if (overlay && expandedCard) {
      overlay.classList.remove('show');
      expandedCard.classList.remove('show');
      
      setTimeout(() => {
        overlay.remove();
        expandedCard.remove();
      }, 300);
    }
  }

  // Save/unsave functionality
  document.querySelectorAll('.icon-btn').forEach(btn=>{
    btn.addEventListener('click', ()=> {
      const pressed = btn.getAttribute('aria-pressed') === 'true';
      btn.setAttribute('aria-pressed', String(!pressed));
      if(btn.textContent.includes('â¤')) {
        btn.textContent = pressed ? 'â¤ Save' : 'âœ” Saved';
      }
    });
  });
  
  // Logout functionality
  document.querySelector('a[href="login.html"]').addEventListener('click', async function(e) {
    e.preventDefault();
    try {
      await fetch('http://localhost:8080/api/logout', {
        method: 'POST',
        credentials: 'include'
      });
    } catch(error) {
      console.error('Logout error:', error);
    }
    window.location.href = 'login.html';
  });
  
  // Tab functionality with animations
  function showMyClubs() {
    const feed = document.querySelector('.feed');
    feed.classList.add('fade-out');
    
    setTimeout(() => {
      const clubs = [
        {id: 1, name: 'Data Science Society', icon: 'ğŸ“Š', category: 'Technology', members: 200, description: 'Explore data analytics, machine learning, and AI. All skill levels welcome.'},
        {id: 2, name: 'Fencing Club', icon: 'ğŸ¤º', category: 'Sports', members: 75, description: 'Learn the art of fencing. Equipment provided for beginners. Join our competitive team.'},
        {id: 3, name: 'Association of Computing Machinery', icon: 'ğŸ’»', category: 'Technology', members: 350, description: 'Join ACM for coding workshops, hackathons, and tech talks. Network with industry professionals.'}
      ];
      
      const savedClubs = clubs.filter(club => savedFlyers.some(f => f.id === club.id));
      
      if (savedClubs.length === 0) {
        feed.innerHTML = `
          <div class="poster" style="background:linear-gradient(180deg,#ffffff,#f1f5f9);border:2px solid rgba(255,255,255,0.8);text-align:center;padding:40px;">
            <h3 style="color:#1e293b;margin-bottom:15px;">ğŸ›ï¸ My Clubs</h3>
            <p style="color:#475569;margin:20px 0;">No clubs saved yet. Save clubs from the Discover tab!</p>
            <button class="btn" onclick="loadFlyers()">Discover Clubs</button>
          </div>
        `;
      } else {
        let clubsHTML = '';
        savedClubs.forEach(club => {
          clubsHTML += `
            <article class="poster" style="background:linear-gradient(180deg,#fff4f2,#fff7f0);border:2px solid rgba(255,255,255,0.8);padding:20px;">
              <div class="club-header" style="margin-bottom:12px;">
                <div style="display:flex;align-items:center;">
                  <div class="club-icon">${club.icon}</div>
                  <div class="club-info">
                    <h4 style="color:#1e293b;font-weight:700;">${club.name}</h4>
                    <div class="small" style="color:#475569;font-weight:500;">${club.category} â€¢ ${club.members} members</div>
                  </div>
                </div>
                <div class="small" style="color:#059669;font-weight:600;">â­ Saved</div>
              </div>
              <p style="color:#475569;font-weight:500;margin:0 0 12px 0;">${club.description}</p>
              <div class="club-actions">
                <button class="btn" onclick="openDetails('${club.name}', this)">Visit Club</button>
                <button class="icon-btn" onclick="unsaveFromMyClubs(${club.id})">â¤ï¸ Unsave</button>
              </div>
            </article>
          `;
        });
        clubsHTML += `<div style="text-align:center;margin-top:20px;"><button class="btn" onclick="loadFlyers()">â† Back to Discover</button></div>`;
        feed.innerHTML = clubsHTML;
      }
      
      feed.classList.remove('fade-out');
      feed.classList.add('fade-in');
    }, 150);
  }
  
  function showPostForm() {
    const feed = document.querySelector('.feed');
    feed.classList.add('fade-out');
    
    setTimeout(() => {
      feed.innerHTML = `
        <div class="poster" style="background:linear-gradient(180deg,#ffffff,#f1f5f9);border:2px solid rgba(255,255,255,0.8);">
          <h3 style="color:#1e293b;font-weight:700;">ğŸ¨ Create New Flyer</h3>
          <form onsubmit="createFlyer(event)" id="flyerForm">
            <input type="text" placeholder="Event Title" required class="input" style="width:100%;margin:10px 0;background:rgba(255,255,255,0.9);border:1px solid rgba(0,0,0,0.2);color:#1e293b;">
            <input type="text" placeholder="Organization Name" required class="input" style="width:100%;margin:10px 0;background:rgba(255,255,255,0.9);border:1px solid rgba(0,0,0,0.2);color:#1e293b;">
            <textarea placeholder="Event Description" required class="input" style="width:100%;margin:10px 0;height:120px;resize:vertical;background:rgba(255,255,255,0.9);border:1px solid rgba(0,0,0,0.2);color:#1e293b;"></textarea>
            <input type="date" required class="input" style="width:100%;margin:10px 0;background:rgba(255,255,255,0.9);border:1px solid rgba(0,0,0,0.2);color:#1e293b;">
            <label style="display:block;color:#1e293b;font-weight:500;margin:10px 0 5px 0;">Event Details (optional)</label>
            <input type="text" placeholder="Event Time (e.g., Mondays 6:00 PM)" id="eventTime" class="input" style="width:100%;margin:10px 0;background:rgba(255,255,255,0.9);border:1px solid rgba(0,0,0,0.2);color:#1e293b;">
            <label style="display:block;color:#1e293b;font-weight:500;margin:10px 0 5px 0;">Attach Image (optional)</label>
            <input type="file" accept="image/*" id="imageUpload" class="input" style="width:100%;margin:10px 0;background:rgba(255,255,255,0.9);border:1px solid rgba(0,0,0,0.2);color:#1e293b;padding:8px;">
            <button type="submit" class="btn">ğŸš€ Post Flyer</button>
          </form>
          <button class="btn" onclick="loadFlyers()" style="margin-top:15px;background:rgba(255,255,255,0.8);color:#374151;border:1px solid rgba(0,0,0,0.15);">â† Cancel</button>
        </div>
      `;
      feed.classList.remove('fade-out');
      feed.classList.add('fade-in');
    }, 150);
  }
  
  function createFlyer(event) {
    event.preventDefault();
    const form = event.target;
    const title = form.querySelector('input[placeholder="Event Title"]').value;
    const org = form.querySelector('input[placeholder="Organization Name"]').value;
    const description = form.querySelector('textarea').value;
    const date = form.querySelector('input[type="date"]').value;
    const eventTime = form.querySelector('#eventTime').value;
    const imageFile = form.querySelector('#imageUpload').files[0];
    
    const newPost = {
      id: Date.now(),
      title: title,
      org: org,
      description: description,
      date: date,
      eventTime: eventTime,
      isUserCreated: true
    };
    
    if (imageFile) {
      const reader = new FileReader();
      reader.onload = function(e) {
        newPost.image = e.target.result;
        createdPosts.push(newPost);
        localStorage.setItem('createdPosts', JSON.stringify(createdPosts));
        alert('Flyer created successfully!');
        loadFlyers();
      };
      reader.readAsDataURL(imageFile);
    } else {
      createdPosts.push(newPost);
      localStorage.setItem('createdPosts', JSON.stringify(createdPosts));
      alert('Flyer created successfully!');
      loadFlyers();
    }
  }
  
  // Save/unsave functionality with local storage
  function toggleSave(flyerId, button) {
    const isSaved = button.textContent.includes('Saved');
    
    // Check if it's a user-created post
    const userPost = createdPosts.find(p => p.id === flyerId);
    const flyerData = userPost || {
      id: flyerId,
      title: flyerId === 1 ? 'Data Science Society' : flyerId === 2 ? 'Fencing Club' : 'Association of Computing Machinery',
      description: flyerId === 1 ? 'Explore data analytics, machine learning, and AI' : flyerId === 2 ? 'Learn the art of fencing' : 'Join ACM for coding workshops and hackathons',
      image: flyerId === 1 ? '../assets/image.png' : flyerId === 2 ? '../assets/image copy.png' : '../assets/image copy 2.png'
    };
    
    if (isSaved) {
      // Remove from saved
      savedFlyers = savedFlyers.filter(f => f.id !== flyerId);
      button.textContent = 'â¤ Save';
      button.setAttribute('aria-pressed', 'false');
    } else {
      // Add to saved
      savedFlyers.push(flyerData);
      button.textContent = 'âœ” Saved';
      button.setAttribute('aria-pressed', 'true');
    }
    
    localStorage.setItem('savedFlyers', JSON.stringify(savedFlyers));
  }
  
  // Local storage for saved flyers and created posts
  let savedFlyers = JSON.parse(localStorage.getItem('savedFlyers') || '[]');
  let createdPosts = JSON.parse(localStorage.getItem('createdPosts') || '[]');
  let myEvents = JSON.parse(localStorage.getItem('myEvents') || '[]');
  
  // Show favorites tab
  function showFavorites() {
    const feed = document.querySelector('.feed');
    feed.classList.add('fade-out');
    
    setTimeout(() => {
      if (savedFlyers.length === 0) {
        feed.innerHTML = `
          <div class="poster" style="min-height:300px;background:linear-gradient(180deg,#ffffff,#f1f5f9);border:2px solid rgba(255,255,255,0.8);text-align:center;">
            <h3 style="color:#1e293b;margin-top:50px;">â¤ï¸ No Saved Flyers</h3>
            <p style="color:#475569;margin:20px 0;">Start saving flyers you're interested in!</p>
            <button class="btn" onclick="loadFlyers()">Discover Flyers</button>
          </div>
        `;
      } else {
        let favoritesHTML = '';
        savedFlyers.forEach((flyer, index) => {
          favoritesHTML += `
            <article class="poster" style="background:linear-gradient(180deg,#fff4f2,#fff7f0);border:2px solid rgba(255,255,255,0.8);">
              <div class="meta">
                <div>
                  <h3 style="color:#1e293b;font-weight:700;">${flyer.title}</h3>
                  <div class="small" style="color:#475569;">Saved Flyer</div>
                </div>
                <div class="small" style="color:#059669;">â­ Saved</div>
              </div>
              ${flyer.image ? `<img src="${flyer.image}" alt="${flyer.title}">` : `<div class="poster-img" style="background:linear-gradient(135deg,#ffd6e0,#ffd7b5);">ğŸ† ${flyer.title}</div>`}
              <div>
                <p style="color:#475569;margin:15px 0;">${flyer.description}</p>
                <div class="actions">
                  <button class="icon-btn" onclick="removeFavorite(${index})">âŒ Remove</button>
                  <button class="btn" onclick="openDetails('${flyer.title}', this)">View Details</button>
                </div>
              </div>
            </article>
          `;
        });
        favoritesHTML += `<div style="text-align:center;margin-top:20px;"><button class="btn" onclick="loadFlyers()">â† Back to Discover</button></div>`;
        feed.innerHTML = favoritesHTML;
      }
      
      feed.classList.remove('fade-out');
      feed.classList.add('fade-in');
    }, 150);
  }
  
  // Remove from favorites
  function removeFavorite(index) {
    savedFlyers.splice(index, 1);
    localStorage.setItem('savedFlyers', JSON.stringify(savedFlyers));
    showFavorites(); // Refresh the view
  }
  
  // Show discussion tab
  function showDiscussion() {
    const feed = document.querySelector('.feed');
    feed.classList.add('fade-out');
    
    setTimeout(() => {
      feed.innerHTML = `
        <div class="poster" style="background:linear-gradient(180deg,#ffffff,#f1f5f9);border:2px solid rgba(255,255,255,0.8);">
          <h3 style="color:#1e293b;font-weight:700;margin-bottom:15px;">ğŸ’¬ Discussion Board</h3>
          <form onsubmit="postMessage(event)" style="display:flex;flex-direction:column;gap:10px;">
            <textarea id="messageInput" placeholder="Share your thoughts..." required style="width:100%;min-height:100px;padding:12px;border-radius:10px;border:1px solid rgba(0,0,0,0.15);background:rgba(255,255,255,0.9);color:#1e293b;resize:vertical;font-family:inherit;"></textarea>
            <button type="submit" class="btn" style="align-self:flex-start;">Post Message</button>
          </form>
        </div>
        <div id="messageList"></div>
      `;
      
      feed.classList.remove('fade-out');
      feed.classList.add('fade-in');
      
      loadMessages();
    }, 150);
  }
  
  // Add event to my events
  function addToEvents(eventName, eventTime) {
    const eventExists = myEvents.find(e => e.name === eventName);
    if (eventExists) {
      alert('Event already added!');
      return;
    }
    
    myEvents.push({
      id: Date.now(),
      name: eventName,
      time: eventTime,
      addedDate: new Date().toLocaleDateString()
    });
    
    localStorage.setItem('myEvents', JSON.stringify(myEvents));
    alert('Event added to your calendar!');
  }
  
  // Show events tab
  function showEvents() {
    const feed = document.querySelector('.feed');
    feed.classList.add('fade-out');
    
    setTimeout(() => {
      if (myEvents.length === 0) {
        feed.innerHTML = `
          <div class="poster" style="background:linear-gradient(180deg,#ffffff,#f1f5f9);border:2px solid rgba(255,255,255,0.8);text-align:center;padding:40px;">
            <h3 style="color:#1e293b;margin-bottom:15px;">ğŸ“… My Events</h3>
            <p style="color:#475569;margin:20px 0;">No events added yet. Add events from the Discover tab!</p>
          </div>
        `;
      } else {
        let eventsHTML = '';
        myEvents.forEach((event, index) => {
          eventsHTML += `
            <article class="poster" style="background:linear-gradient(180deg,#ffffff,#f1f5f9);border:2px solid rgba(255,255,255,0.8);">
              <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
                <h3 style="color:#1e293b;font-weight:700;margin:0;">${event.name}</h3>
                <button class="icon-btn" onclick="removeEvent(${index})" style="background:rgba(239,68,68,0.1);border-color:rgba(239,68,68,0.3);color:#dc2626;">âŒ</button>
              </div>
              <div style="color:#475569;font-weight:500;margin-bottom:8px;">
                <div style="margin-bottom:6px;">ğŸ• ${event.time}</div>
                <div style="font-size:0.85rem;color:#64748b;">Added: ${event.addedDate}</div>
              </div>
            </article>
          `;
        });
        feed.innerHTML = eventsHTML;
      }
      
      feed.classList.remove('fade-out');
      feed.classList.add('fade-in');
    }, 150);
  }
  
  // Remove event
  function removeEvent(index) {
    myEvents.splice(index, 1);
    localStorage.setItem('myEvents', JSON.stringify(myEvents));
    showEvents();
  }
  
  // Unsave from My Clubs
  function unsaveFromMyClubs(flyerId) {
    savedFlyers = savedFlyers.filter(f => f.id !== flyerId);
    localStorage.setItem('savedFlyers', JSON.stringify(savedFlyers));
    showMyClubs();
  }
  
  // Share flyer
  function shareFlyer(clubName) {
    const shareUrl = `${window.location.origin}${window.location.pathname}?club=${encodeURIComponent(clubName)}`;
    navigator.clipboard.writeText(shareUrl).then(() => {
      alert(`Link copied to clipboard! Share this link: ${shareUrl}`);
    }).catch(() => {
      alert(`Share this link: ${shareUrl}`);
    });
  }
  
  // Post message function
  function postMessage(event) {
    event.preventDefault();
    const input = document.getElementById('messageInput');
    const message = input.value.trim();
    if (!message) return;
    
    // Get existing messages
    let messages = JSON.parse(localStorage.getItem('discussionMessages') || '[]');
    
    // Add new message
    messages.unshift({
      id: Date.now(),
      text: message,
      timestamp: new Date().toLocaleString(),
      author: 'You'
    });
    
    // Save to localStorage
    localStorage.setItem('discussionMessages', JSON.stringify(messages));
    
    // Clear input
    input.value = '';
    
    // Reload messages
    loadMessages();
  }
  
  // Load messages function
  function loadMessages() {
    const messageList = document.getElementById('messageList');
    const messages = JSON.parse(localStorage.getItem('discussionMessages') || '[]');
    
    if (messages.length === 0) {
      messageList.innerHTML = '<p style="color:#475569;text-align:center;margin:20px 0;">No messages yet. Be the first to start a discussion!</p>';
      return;
    }
    
    messageList.innerHTML = messages.map(msg => `
      <div class="poster discussion-post" style="background:linear-gradient(180deg,#ffffff,#f1f5f9);border:2px solid rgba(255,255,255,0.8);padding:16px;transition:transform 0.3s ease, box-shadow 0.3s ease;">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
          <div style="font-weight:700;color:#1e293b;font-size:1rem;">${msg.author}</div>
          <div style="font-size:0.8rem;color:#64748b;">${msg.timestamp}</div>
        </div>
        <div style="color:#475569;font-weight:500;">${msg.text}</div>
      </div>
    `).join('');
  }
  
  // Initialize page
  checkAuth();
  loadFlyers();
</script>
</body>
</html>
